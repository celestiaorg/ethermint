name: ephemeral

on:
  push:
    branches:
      - '**'
  workflow_dispatch:

jobs:  
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Clone repo
      uses: actions/checkout@v2
    - name: Clone ephemeral-cluster repo
      uses: actions/checkout@v2
      with:
        repository: celestiaorg/ephemeral-cluster
        path: ephemeral
        ref: jbowen93/evmos
    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.17
    - name: "Setup and Test Cluster"
      run: |
        cd ephemeral
        echo "pwd" && pwd 
        echo "ls" && ls 
        echo "ls docker" && ls docker
        ./debug-start-cluster.sh 
    - name: "Test Cluster"
      run: | 
        docker ps
        echo "sleep 15" && sleep 15
        cd /home/runner/work/ethermint/ethermint
        MODE=rpc HOST=http://127.0.0.1:8545 go test ./tests/rpc/...
        cd /home/runner/work/ethermint/ethermint
        MODE=rpc HOST=http://127.0.0.1:8545 go test ./tests/rpc/...

